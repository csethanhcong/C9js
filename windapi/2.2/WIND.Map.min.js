WIND.Map=function(e,t){this.type="map";this.top=10;this.left=10;this.width=600;this.height=400;this.color="#3366CC";this.border="#3366CC 2px solid";this.name="Map Displayer";this.icon=lib_path+"images/mvizicon.png";this.draggable=false;this.resizable=false;this.header=false;this.removable=false;this.configurable=false;this.zoomable=true;this.pannable=true;this.showscale=true;this.showposition=true;this.showlocation=false;this.showitinerary=false;this.showtoolbar=false;wind_map=true;this.tool=new Array;if(t){if(t.draggable==true)this.draggable=t.draggable;if(t.resizable==true)this.resizable=t.resizable;if(t.header==true)this.header=t.header;if(t.removable==true)this.removable=t.removable;if(t.configurable==true)this.configurable=t.configurable;if(this.draggable==true||this.removable==true||this.configurable==true)this.header=true;if(t.zoomable==false)this.zoomable=false;if(t.pannable==false)this.pannable=false;if(t.type){this.baseLayer=t.type}if(t.longitude||t.longitude==0){this.longitude=t.longitude}if(t.latitude||t.latitude==0){this.latitude=t.latitude}if(t.zoom||t.zoom==0){this.zoom=t.zoom}}var n=document.createElement("div");n.id=e+"Outer";n.style.position="absolute";if(t.top)this.top=t.top;n.style.top=this.top+"px";if(t.left)this.left=t.left;n.style.left=this.left+"px";if(t.width)this.width=t.width;n.style.width=this.width+"px";if(t.height)this.height=t.height;n.style.height=this.height+"px";if(t.color)this.color=t.color;if(t.border)this.border=t.border;n.style.border=this.border;if(t.parentEl)this.parentEl=t.parentEl;if(t.name)this.name=t.name;if(t.icon)this.icon=t.icon;var r;if(document.getElementById(e))r=document.getElementById(e);else{r=document.createElement("div");r.id=e}r.style.position="absolute";r.style.top="0px";r.style.width="100%";r.style.height="100%";n.appendChild(r);if(t.parentEl){this.parentEl=t.parentEl;document.getElementById(t.parentEl).appendChild(n)}else document.body.appendChild(n);if(this.header){var i=document.createElement("div");i.id=e+"Handle";i.style.position="absolute";i.style.width="100%";i.style.height="20px";i.style.backgroundColor=this.color;if(this.draggable)i.style.cursor="move";i.style.zIndex=2;var s=document.createElement("img");s.src=this.icon;s.alt="[ ]";s.title="MapDisplayer";s.style.cssFloat="left";i.appendChild(s);var o=document.createElement("span");o.style.color="#FFFFFF";o.style.paddingLeft="3px";o.appendChild(document.createTextNode(this.name));i.appendChild(o);var u=document.createElement("div");u.id=e+"Configuration";u.style.position="absolute";u.style.width="100%";u.style.marginTop="20px";u.style.backgroundColor="#E4E4E4";u.style.zIndex=11;u.style.display="none";n.appendChild(u);var a=this;var f=document.createElement("span");f.appendChild(document.createTextNode("Name: "));u.appendChild(f);var l=document.createElement("input");l.type="text";l.id=e+"Configuration_Name";l.name=e+"Configuration_Name";l.size="30";l.value=this.name;u.appendChild(l);l.onblur=function(){var t=document.getElementById(e+"Configuration_Name").value;if(t!=null&&t!=""){a.name=t;o.removeChild(o.firstChild);o.appendChild(document.createTextNode(a.name))}a.eventConfigured.fire(a)};u.appendChild(document.createElement("br"));var c=document.createElement("span");c.appendChild(document.createTextNode("Color: "));u.appendChild(c);var h=document.createElement("select");h.id=e+"Configuration_Color";h.name=e+"Configuration_Color";u.appendChild(h);h.style.background=this.color;var p=["#00248E","#0033CC","#809FFE","#BFCFFE","#12127D","#1919B3","#9191FE","#C8C8FE","#24006B","#330099","#AA80FE","#D4BFFE","#2D006B","#400099","#B580FE","#DABFFE","#47006B","#660099","#D580FE","#EABFFE","#6B006B","#990099","#FF80FE","#FFBFFE","#8E006B","#CC0099","#FE80DF","#FEBFEF","#A10048","#E60066","#FE80B9","#FEBFDC","#B20000","#FF0000","#FE8080","#FEBFBF","#B22400","#FF3300","#FE9980","#FECCBF","#B24700","#FF6600","#FEB380","#FED9BF","#B25900","#FF8000","#FEBF80","#FEDFBF","#B26B00","#FF9900","#FECC80","#FEE6BF","#B27D00","#FFB200","#FED980","#FEECBF","#B28F00","#FFCC00","#FEE680","#FEF2BF","#B2A100","#FFE500","#FEF280","#FEF9BF","#B2B300","#FFFF00","#FEFF80","#FEFFBF","#8FB200","#CCFF00","#E6FE80","#F2FEBF","#6BB200","#99FF00","#CCFE80","#E6FEBF","#24B200","#33FF00","#99FE80","#CCFEBF","#008E00","#00CC00","#80FE80","#BFFEBF","#007D47","#00B366","#80FEC8","#BFFEE3","#006B6B","#009999","#80FFFE","#BFFFFE","#00477D","#0066B3","#80C8FE","#BFE3FE"];for(var d=0;d<p.length;d++){var v=new Option(p[d],p[d]);v.style.background=p[d];v.style.position="absolute";v.style.width="100px";v.style.height="30px";if(p[d]==this.color)v.selected=true;h.add(v)}h.onchange=function(){h.style.background=this.options[this.selectedIndex].value;a.color=this.options[this.selectedIndex].value;a.border=this.options[this.selectedIndex].value+" 2px solid";document.getElementById(e+"Handle").style.backgroundColor=a.color;document.getElementById(e+"Outer").style.border=a.border};u.appendChild(document.createElement("br"));var m=document.createElement("span");m.appendChild(document.createTextNode("Zoomable: "));u.appendChild(m);var g=document.createElement("input");g.type="radio";g.id=e+"Configuration_Zoomable_Yes";g.name=e+"Configuration_Zoomable";if(this.zoomable==true)g.checked="checked";u.appendChild(g);var y=document.createElement("label");y.appendChild(document.createTextNode("Yes "));u.appendChild(y);var b=document.createElement("input");b.type="radio";b.id=e+"Configuration_Zoomable_No";b.name=e+"Configuration_Zoomable";if(this.zoomable==false)b.checked="checked";u.appendChild(b);var w=document.createElement("label");w.appendChild(document.createTextNode("No "));u.appendChild(w);g.onclick=function(){a.zoomable=true;if(a.pannable)a.setMouseControl({zoomWheelEnabled:true,zoomBoxEnabled:true,zoomDbClickEnabled:true,panEnabled:true});else a.setMouseControl({zoomWheelEnabled:true,zoomBoxEnabled:true,zoomDbClickEnabled:true,panEnabled:false});a.addZoomControl()};b.onclick=function(){a.zoomable=false;if(a.pannable)a.setMouseControl({zoomWheelEnabled:false,zoomBoxEnabled:false,zoomDbClickEnabled:false,panEnabled:true});else a.setMouseControl({zoomWheelEnabled:false,zoomBoxEnabled:false,zoomDbClickEnabled:false,panEnabled:false});a.removeZoomControl()};u.appendChild(document.createElement("br"));var E=document.createElement("span");E.appendChild(document.createTextNode("Pannable: "));u.appendChild(E);var S=document.createElement("input");S.type="radio";S.id=e+"Configuration_Pannable_Yes";S.name=e+"Configuration_Pannable";if(this.pannable==true)S.checked="checked";u.appendChild(S);var x=document.createElement("label");x.appendChild(document.createTextNode("Yes "));u.appendChild(x);var T=document.createElement("input");T.type="radio";T.id=e+"Configuration_Pannable_No";T.name=e+"Configuration_Pannable";if(this.pannable==false)T.checked="checked";u.appendChild(T);var N=document.createElement("label");N.appendChild(document.createTextNode("No "));u.appendChild(N);S.onclick=function(){a.pannable=true;if(a.zoomable)a.setMouseControl({zoomWheelEnabled:true,zoomBoxEnabled:true,zoomDbClickEnabled:true,panEnabled:true});else a.setMouseControl({zoomWheelEnabled:false,zoomBoxEnabled:false,zoomDbClickEnabled:false,panEnabled:true})};T.onclick=function(){a.pannable=false;if(a.zoomable)a.setMouseControl({zoomWheelEnabled:true,zoomBoxEnabled:true,zoomDbClickEnabled:true,panEnabled:false});else a.setMouseControl({zoomWheelEnabled:false,zoomBoxEnabled:false,zoomDbClickEnabled:false,panEnabled:false})};u.appendChild(document.createElement("br"));var C=document.createElement("span");C.appendChild(document.createTextNode("Show scale: "));u.appendChild(C);var k=document.createElement("input");k.type="radio";k.id=e+"Configuration_Showscale_Yes";k.name=e+"Configuration_Showscale";if(this.showscale==true)k.checked="checked";u.appendChild(k);var L=document.createElement("label");L.appendChild(document.createTextNode("Yes "));u.appendChild(L);var A=document.createElement("input");A.type="radio";A.id=e+"Configuration_Showscale_No";A.name=e+"Configuration_Showscale";if(this.showscale==false)A.checked="checked";u.appendChild(A);var O=document.createElement("label");O.appendChild(document.createTextNode("No "));u.appendChild(O);k.onclick=function(){a.showscale=true;a.scaleControl=new OpenLayers.Control.Scale;a.olMap.addControl(a.scaleControl)};A.onclick=function(){a.showscale=false;a.olMap.removeControl(a.scaleControl)};u.appendChild(document.createElement("br"));var M=document.createElement("span");M.appendChild(document.createTextNode("Show position: "));u.appendChild(M);var _=document.createElement("input");_.type="radio";_.id=e+"Configuration_Showposition_Yes";_.name=e+"Configuration_Showposition";if(this.showposition==true)_.checked="checked";u.appendChild(_);var D=document.createElement("label");D.appendChild(document.createTextNode("Yes "));u.appendChild(D);var P=document.createElement("input");P.type="radio";P.id=e+"Configuration_Showposition_No";P.name=e+"Configuration_Showposition";if(this.showposition==false)P.checked="checked";u.appendChild(P);var H=document.createElement("label");H.appendChild(document.createTextNode("No "));u.appendChild(H);_.onclick=function(){a.showposition=true;a.positionControl=new OpenLayers.Control.MousePosition;a.olMap.addControl(a.positionControl)};P.onclick=function(){a.showposition=false;a.olMap.removeControl(a.positionControl)};u.appendChild(document.createElement("br"));var B=document.createElement("span");B.appendChild(document.createTextNode("Layers: "));u.appendChild(B);for(var d=0;d<WIND.Map.Type.length;d++){var j=document.createElement("input");j.type="checkbox";j.id=e+"Configuration_Layer"+d;j.name=e+"Configuration_Layer"+d;u.appendChild(j);var F=document.createElement("label");F.appendChild(document.createTextNode(WIND.Map.Type[d]+" "));u.appendChild(F);if(WIND.Map.Type[d]==this.baseLayer){j.checked=true;j.disabled=true}j.onclick=function(e){var t=this.id;var n=t.substring(t.length-1,t.length);if(this.checked)a.addLayer(WIND.Map.Type[Number(n)],false);else a.removeLayer(WIND.Map.Type[Number(n)])}}u.appendChild(document.createElement("br"));var I=document.createElement("span");I.appendChild(document.createTextNode("Toolbar: "));u.appendChild(I);var q=document.createElement("input");q.type="radio";q.id=e+"Configuration_Showtoolbar_Yes";q.name=e+"Configuration_Showtoolbar";if(this.showtoolbar==true)q.checked="checked";u.appendChild(q);var R=document.createElement("label");R.appendChild(document.createTextNode("Yes "));u.appendChild(R);var U=document.createElement("input");U.type="radio";U.id=e+"Configuration_Showtoolbar_No";U.name=e+"Configuration_Showtoolbar";if(this.showtoolbar==false)U.checked="checked";u.appendChild(U);var z=document.createElement("label");z.appendChild(document.createTextNode("No "));u.appendChild(z);q.onclick=function(){a.showtoolbar=true;X.disabled=false;W.src=lib_path+"images/draw_point_on.png";$.disabled=false;V.src=lib_path+"images/draw_line_on.png";K.disabled=false;J.src=lib_path+"images/draw_polygon_on.png";a.addToolBarLite()};U.onclick=function(){a.showtoolbar=false;X.disabled=true;W.src=lib_path+"images/draw_point_off.png";$.disabled=true;V.src=lib_path+"images/draw_line_off.png";K.disabled=true;J.src=lib_path+"images/draw_polygon_off.png";a.removeToolBar()};u.appendChild(document.createElement("br"));var W=document.createElement("img");if(this.showtoolbar==true){W.src=lib_path+"images/draw_point_on.png"}else{W.src=lib_path+"images/draw_point_off.png"}W.alt="Point";W.title="Point";u.appendChild(W);var X=document.createElement("input");X.type="checkbox";X.id=e+"Configuration_Toolbar_PointChoice";X.name=e+"Configuration_Toolbar_PointChoice";u.appendChild(X);if(this.showtoolbar==false){X.disabled=true}if(this.showtoolbar==true){X.disabled=false}var a=this;X.onclick=function(e){if(this.checked){a.addDrawing2ToolBar("point")}};var V=document.createElement("img");if(this.showtoolbar==true){V.src=lib_path+"images/draw_line_on.png"}else{V.src=lib_path+"images/draw_line_off.png"}V.alt="Line";V.title="Line";u.appendChild(V);var $=document.createElement("input");$.type="checkbox";$.id=e+"Configuration_Toolbar_LineChoice";$.name=e+"Configuration_Toolbar_LineChoice";u.appendChild($);if(this.showtoolbar==false){$.disabled=true}if(this.showtoolbar==true){$.disabled=false}$.onclick=function(e){if(this.checked){a.addDrawing2ToolBar("line")}};var J=document.createElement("img");if(this.showtoolbar==true){J.src=lib_path+"images/draw_polygon_on.png"}else{J.src=lib_path+"images/draw_polygon_off.png"}J.alt="Polygon";J.title="Polygon";u.appendChild(J);var K=document.createElement("input");K.type="checkbox";K.id=e+"Configuration_Toolbar_PolygonChoice";K.name=e+"Configuration_Toolbar_PolygonChoice";u.appendChild(K);if(this.showtoolbar==false){K.disabled=true}if(this.showtoolbar==true){K.disabled=false}K.onclick=function(e){if(this.checked){a.addDrawing2ToolBar("polygon")}};u.appendChild(document.createElement("br"));u.appendChild(document.createElement("br"));this.eventConfigured=new YAHOO.util.CustomEvent("eventConfigured");this.eventConfigured.subscribe(this.onConfigure,this,true);var Q=document.createElement("input");Q.type="button";Q.id=e+"Configuration_Cancel";Q.name=e+"Configuration_Cancel";Q.value="Close";u.appendChild(Q);Q.onclick=function(){u.style.display="none"};if(this.removable){this.eventRemoved=new YAHOO.util.CustomEvent("eventRemoved");var G=document.createElement("img");G.src=lib_path+"images/close.png";G.alt="X";G.title="Click to delete";G.style.backgroundColor="#EFEFEF";G.style.cssFloat="right";G.style.cursor="pointer";i.appendChild(G);G.onclick=function(){if(confirm("Do you really want to delete it?")){a.destroy();a.eventRemoved.fire(a)}};this.eventRemoved.subscribe(this.onRemove,this,true)}if(this.configurable){var Y=document.createElement("img");Y.src=lib_path+"images/gear.png";Y.alt="*";Y.title="Click to configure";Y.style.cssFloat="right";Y.style.marginRight="10px";Y.style.cursor="pointer";i.appendChild(Y);Y.onclick=function(){u.style.display="block"}}n.appendChild(i);if(this.draggable){var Z=new YAHOO.util.DD(e+"Outer");Z.setHandleElId(e+"Handle");this.eventDragged=new YAHOO.util.CustomEvent("eventDragged");Z.on("endDragEvent",function(e){this.eventDragged.fire(this)},this,true);this.eventDragged.subscribe(this.onDrag,this,true);if(t.parentEl){var et=document.getElementById(t.parentEl);var tt=n.offsetLeft-et.offsetLeft;var nt=n.offsetTop-et.offsetTop;var rt=et.offsetTop+et.offsetHeight-n.offsetTop-n.offsetHeight;Z.setXConstraint(tt);Z.setYConstraint(nt)}else{var tt=n.offsetLeft;var nt=n.offsetTop;Z.setXConstraint(tt);Z.setYConstraint(nt)}}}if(this.resizable){var it=document.createElement("div");it.id="yui-gen0";it.className="yui-resize-handle yui-resize-handle-r";var st=document.createElement("div");st.className="yui-resize-handle-inner-r";it.appendChild(st);n.appendChild(it);var it=document.createElement("div");it.id="yui-gen1";it.className="yui-resize-handle yui-resize-handle-b";var st=document.createElement("div");st.className="yui-resize-handle-inner-b";it.appendChild(st);n.appendChild(it);var it=document.createElement("div");it.id="yui-gen2";it.className="yui-resize-handle yui-resize-handle-br";var st=document.createElement("div");st.className="yui-resize-handle-inner-br";it.appendChild(st);n.appendChild(it);var ot=new YAHOO.util.Resize(e+"Outer",{minWidth:160,minHeight:160,maxWidth:1200,maxHeight:800});this.eventResized=new YAHOO.util.CustomEvent("eventResized");ot.on("endResize",function(e){this.eventResized.fire(this)},this,true);this.eventResized.subscribe(this.onResize,this,true)}this.container=e;this.parentDocument=null;this.olMap=null;this.scaleControl=null;this.positionControl=null;this.mouseControl=null;this.keyboardControl=null;this.zoomControl=null;this.switcher=null;this.toolbar=null;this.locationbar=null;this.itinerarybar=null;if(!this.baseLayer){this.baseLayer="Google Street"}this.typeList=[];this.parts=[];this.vectorLayers=[];this.vlIndex=[];this.annotations=[];this.itineraries=[];this.interactionList=[];var ut=false;for(var d=0;d<WIND.Map.Type.length;d++){if(this.baseLayer==WIND.Map.Type[d]){ut=true;break}}if(ut){this.render()}else{document.getElementById(this.container).innerHTML="Don't support map type "+this.baseLayer}};var id_annot;var index_annot=0;WIND.Map.prototype.onDrag=function(){this.top=document.getElementById(this.container+"Outer").offsetTop;this.left=document.getElementById(this.container+"Outer").offsetLeft};WIND.Map.prototype.onResize=function(){this.width=document.getElementById(this.container+"Outer").offsetWidth;this.height=document.getElementById(this.container+"Outer").offsetHeight};WIND.Map.prototype.onConfigure=function(){};WIND.Map.prototype.onRemove=function(){};WIND.Map.prototype.addAnnotation=function(e){var t=false;for(var n=0;n<e.annotedObjects.length;n++){if(e.annotedObjects.type=="map"){t=true;break}}this.annotations.push(e)};WIND.Map.prototype.createAnnotation=function(e,t,n,r,i){var s;if(!i||!this.vlIndex.indexOf(i))s=0;else s=i;var o=this.createSensiblePart(n,r,s);var u=new WIND.Annotation(e,t,o);this.annotations.push(u);return u};WIND.Map.prototype.getValue=function(){var e=this.olMap.getCenter().clone();e.transform(this.olMap.baseLayer.projection,new OpenLayers.Projection("EPSG:4326"));var t=this.olMap.getZoom();return{id:this.container,ref:this.ref,rdftype:"http://erozate.iutbayonne.univ-pau.fr/wind#MapComponent",name:this.name,position:{top:this.top,left:this.left},size:{width:this.width,height:this.height},style:{color:this.color,border:this.border,icon:this.icon},annotation:this.annotation,display:this.display,load:this.load,parameter:{draggable:this.draggable?"yes":"no",resizable:this.resizable?"yes":"no",removable:this.removable?"yes":"no",configurable:this.configurable?"yes":"no",header:this.header?"yes":"no",zoomable:this.zoomable?"yes":"no",pannable:this.pannable?"yes":"no",scaleControl:this.showscale==true?"yes":"no",positionControl:this.showposition==true?"yes":"no",mouseControl:this.mouseControl?"yes":"no",keyboardControl:this.keyboardControl?"yes":"no",zoomControl:this.zoomControl?"yes":"no",switcher:this.switcher?"yes":"no",toolBar:this.showtoolbar?"yes":"no",pointToolBar:this.drawPoint?"yes":"no",lineToolBar:this.drawLine?"yes":"no",polygonToolBar:this.drawPolygon?"yes":"no",locationBar:this.showlocation?"yes":"no",itineraryBar:this.showitinerary?"yes":"no"},layers:this.typeList,center:{longitude:e.lon,latitude:e.lat,zoom:t}}};WIND.Map.Type=["Google Street","Google Hybrid","Google Satellite","Google Terrain","IGN Route","IGN Satellite","OpenStreetMap","Yahoo Street","Yahoo Hybrid","Yahoo Satellite","Bing Road","Bing Hybrid","Bing Aerial"];WIND.Map.prototype.addScaleControl=function(){if(this.scaleControl==null){this.scaleControl=new OpenLayers.Control.Scale;this.olMap.addControl(this.scaleControl)}};WIND.Map.prototype.removeScaleControl=function(){if(this.scaleControl!=null){this.olMap.removeControl(this.scaleControl);this.scaleControl=null}};WIND.Map.prototype.addPositionControl=function(){if(this.positionControl==null){this.positionControl=new OpenLayers.Control.MousePosition;this.olMap.addControl(this.positionControl)}};WIND.Map.prototype.removePositionControl=function(){if(this.positionControl!=null){this.olMap.removeControl(this.positionControl);this.positionControl=null}};WIND.Map.prototype.addMouseControl=function(){if(this.mouseControl==null){this.mouseControl=new OpenLayers.Control.Navigation;this.olMap.addControl(this.mouseControl)}};WIND.Map.prototype.removeMouseControl=function(){if(this.mouseControl!=null){this.mouseControl.destroy()}};WIND.Map.prototype.setMouseControl=function(e){if(this.mouseControl!=null){this.mouseControl.destroy()}if(e.zoomDbClickEnabled){this.mouseControl=new OpenLayers.Control.Navigation;this.olMap.addControl(this.mouseControl)}else{this.mouseControl=new OpenLayers.Control.Navigation({defaultDblClick:function(e){return}});this.olMap.addControl(this.mouseControl)}if(e.zoomWheelEnabled)this.mouseControl.enableZoomWheel();else this.mouseControl.disableZoomWheel();if(e.zoomBoxEnabled)this.mouseControl.enableZoomBox();else this.mouseControl.disableZoomBox();if(e.panEnabled)this.mouseControl.dragPan.activate();else this.mouseControl.dragPan.deactivate()};WIND.Map.prototype.addKeyboardControl=function(){if(this.keyboardControl==null){this.keyboardControl=new OpenLayers.Control.KeyboardDefaults;this.olMap.addControl(this.keyboardControl)}};WIND.Map.prototype.removeKeyboardControl=function(){if(this.keyboardControl!=null){this.olMap.removeControl(this.keyboardControl);this.keyboardControl=null}};WIND.Map.prototype.addZoomControl=function(){if(this.zoomControl==null){var e=document.createElement("div");e.style.position="absolute";e.style.top="60px";e.style.right="10px";e.style.zIndex=10;var t=this;var n=document.createElement("p");var r=document.createElement("input");r.type="button";r.value="+";r.style.fontSize="20px";r.style.border="#80FE80 1px solid";r.style.backgroundColor="#80FE80";r.style.height="30px";r.style.width="30px";r.style.cursor="pointer";r.onclick=function(){t.zoomIn()};n.appendChild(r);e.appendChild(n);var i=document.createElement("p");var s=document.createElement("input");s.type="button";s.value="-";s.style.fontSize="20px";s.style.border="#80FE80 1px solid";s.style.backgroundColor="#80FE80";s.style.height="30px";s.style.width="30px";s.style.cursor="pointer";s.onclick=function(){t.zoomOut()};i.appendChild(s);e.appendChild(i);document.getElementById(this.container+"Outer").appendChild(e);this.zoomControl=e}else this.zoomControl.style.visibility="visible"};WIND.Map.prototype.removeZoomControl=function(){if(this.zoomControl!=null)this.zoomControl.style.visibility="hidden"};WIND.Map.prototype.zoomIn=function(){this.olMap.zoomIn()};WIND.Map.prototype.zoomOut=function(){this.olMap.zoomOut()};WIND.Map.prototype.zoomToExtent=function(e){var t;if(e.length>0){t=e[0].feature.geometry.clone();t.transform(new OpenLayers.Projection("EPSG:4326"),this.olMap.baseLayer.projection);var n=t.getBounds();var r;for(var i=1;i<e.length;i++){t=e[i].feature.geometry.clone();t.transform(new OpenLayers.Projection("EPSG:4326"),this.olMap.baseLayer.projection);r=t.getBounds();n.extend(r)}if(e.length==1&&t instanceof OpenLayers.Geometry.Point){this.olMap.setCenter(new OpenLayers.LonLat(t.x,t.y),17)}else{this.olMap.zoomToExtent(n,false)}}};WIND.Map.prototype.addSwitcher=function(){if(this.switcher==null){var e=document.createElement("div");e.style.position="absolute";e.style.top="42px";e.style.left="2px";e.style.border="#B0B0B0 1px solid";e.style.backgroundColor="#FFFFFF";e.style.zIndex=10;e.style.display="none";e.style.textAlign="left";var t=this;for(var n=0;n<this.typeList.length;n++){if(!this.typeList[n].startsWith("IGN")){var r=document.createElement("input");r.setAttribute("type","radio");if(this.baseLayer==this.typeList[n]){r.checked=true}r.setAttribute("name","layerchoice");r.setAttribute("value",this.typeList[n]);r.onclick=function(){if(t.ignLayersDiv)t.ignLayersDiv.style.display="none";t.changeBaseLayer(this.value)};e.appendChild(r);e.appendChild(document.createTextNode(this.typeList[n]));e.appendChild(document.createElement("br"))}else if(!this.ignLayersDiv){var r=document.createElement("input");r.setAttribute("type","radio");if(this.baseLayer==this.typeList[n]){r.checked=true}r.setAttribute("name","layerchoice");r.setAttribute("value","IGN Maps");e.appendChild(r);e.appendChild(document.createTextNode("IGN Maps"));e.appendChild(document.createElement("br"));var i=document.createElement("div");i.style.position="relative";i.style.left="5px";if(r.checked)i.style.display="block";else i.style.display="none";var s=document.createElement("input");s.setAttribute("type","checkbox");s.setAttribute("value",this.typeList[n]);s.checked=true;i.appendChild(s);i.appendChild(document.createTextNode(this.typeList[n]));i.appendChild(document.createElement("br"));e.appendChild(i);this.ignLayersDiv=i;r.onclick=function(){t.ignLayersDiv.style.display="block";t.changeBaseLayer(this.value)};this.ignBaseLayer=this.typeList[n];var o;s.onclick=function(){for(var e=0;e<t.olMap.layers.length;e++){if(t.olMap.layers[e].name==this.value){o=t.olMap.layers[e]}}if(this.checked)o.setVisibility(true);else o.setVisibility(false)}}else{var s=document.createElement("input");s.setAttribute("type","checkbox");s.setAttribute("value",this.typeList[n]);s.checked=false;this.ignLayersDiv.appendChild(s);this.ignLayersDiv.appendChild(document.createTextNode(this.typeList[n]));this.ignLayersDiv.appendChild(document.createElement("br"));var o;s.onclick=function(){for(var e=0;e<t.olMap.layers.length;e++){if(t.olMap.layers[e].name==this.value){o=t.olMap.layers[e]}}if(this.checked)o.setVisibility(true);else o.setVisibility(false)}}}document.getElementById(this.container+"Outer").appendChild(e);var u=document.createElement("div");u.style.position="absolute";u.style.top="21px";u.style.left="2px";u.style.border="#B0B0B0 1px solid";u.style.backgroundColor="#FFFFFF";u.style.zIndex=10;var a=document.createElement("input");a.type="button";a.value="Layers";a.style.border="#B0B0B0 1px solid";a.style.backgroundColor="#FFFFFF";a.style.cursor="pointer";a.onclick=function(){if(e.style.display=="none"){e.style.display="block";a.style.backgroundColor="#B0B0B0";a.style.color="#FFFFFF"}else{e.style.display="none";a.style.backgroundColor="#FFFFFF";a.style.color="#000000"}};u.appendChild(a);document.getElementById(this.container+"Outer").appendChild(u);this.switcher=e;this.switcherButton=u}else{this.switcherButton.style.visibility="visible";this.switcher.style.visibility="visible"}};WIND.Map.prototype.removeSwitcher=function(){if(this.switcher!=null){this.switcherButton.style.visibility="hidden";this.switcher.style.visibility="hidden"}};WIND.Map.prototype.addToolBarLite=function(){if(this.toolbar==null){var e=document.getElementsByTagName("head")[0];var t=document.createElement("link");t.type="text/css";t.rel="stylesheet";t.href=lib_path+"/styles/toolbar.css";e.appendChild(t);var n=document.createElement("div");n.style.position="absolute";n.style.top="20px";n.style.right="0px";n.className="olControlPanel";n.style.zIndex=10;document.getElementById(this.container+"Outer").appendChild(n);this.toolbardiv=n;this.mousecontrol=new OpenLayers.Control.Navigation({title:"Utiliser la souris pour glisser, faire un zoom sur la carte",displayClass:"olControlMouseDefaults"});this.toolbar=new OpenLayers.Control.Panel({defaultControl:this.mousecontrol,div:this.toolbardiv});this.toolbar.addControls([this.mousecontrol]);this.olMap.addControl(this.toolbar)}};WIND.Map.prototype.addDrawing2ToolBar=function(e,t){var n;if(!t||!this.vlIndex.indexOf(t))n=0;else n=t;switch(e){case"point":var r=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);r.strokeColor="#FF0000";r.strokeWidth=3;r.fillColor="#FECC80";this.drawPoint=new OpenLayers.Control.DrawFeature(this.vectorLayers[n],OpenLayers.Handler.Point,{title:"Dessiner un point",displayClass:"olControlDrawFeaturePoint",handlerOptions:{style:r}});this.toolbar.addControls([this.drawPoint]);break;case"line":var i=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);i.strokeColor="#B26B00";i.strokeWidth=3;i.fillColor="#FECC80";this.drawLine=new OpenLayers.Control.DrawFeature(this.vectorLayers[n],OpenLayers.Handler.Path,{title:"Dessiner une ligne",displayClass:"olControlDrawFeaturePath",handlerOptions:{style:i}});this.toolbar.addControls([this.drawLine]);break;case"polygon":var s=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);s.strokeColor="#0066B3";s.strokeWidth=3;s.fillColor="#FECC80";this.drawPolygon=new OpenLayers.Control.DrawFeature(this.vectorLayers[n],OpenLayers.Handler.Polygon,{title:"Dessiner un polygone",displayClass:"olControlDrawFeaturePolygon",handlerOptions:{style:s}});this.toolbar.addControls([this.drawPolygon]);break}};WIND.Map.prototype.addToolBar=function(){if(this.toolbar==null){var e=document.getElementsByTagName("head")[0];var t=document.createElement("link");t.type="text/css";t.rel="stylesheet";t.href=lib_path+"/styles/toolbar.css";e.appendChild(t);var n=document.createElement("div");n.style.position="absolute";n.style.top="20px";n.style.right="0px";n.className="olControlPanel";n.style.zIndex=10;document.getElementById(this.container+"Outer").appendChild(n);this.toolbardiv=n;this.mousecontrol=new OpenLayers.Control.Navigation({title:"Utiliser la souris pour glisser, faire un zoom sur la carte",displayClass:"olControlMouseDefaults"});this.toolbar=new OpenLayers.Control.Panel({defaultControl:this.mousecontrol,div:this.toolbardiv});this.drawPoint=new OpenLayers.Control.DrawFeature(this.vectorLayers[0],OpenLayers.Handler.Point,{title:"Dessiner un point",displayClass:"olControlDrawFeaturePoint"});this.drawLine=new OpenLayers.Control.DrawFeature(this.vectorLayers[0],OpenLayers.Handler.Path,{title:"Dessiner une ligne",displayClass:"olControlDrawFeaturePath"});this.drawPolygon=new OpenLayers.Control.DrawFeature(this.vectorLayers[0],OpenLayers.Handler.Polygon,{title:"Dessiner un polygone",displayClass:"olControlDrawFeaturePolygon"});this.drawRegularPolygon=new OpenLayers.Control.DrawFeature(this.vectorLayers[0],OpenLayers.Handler.RegularPolygon,{title:"Dessiner un polygon régulier",handlerOptions:{sides:4},displayClass:"olControlDrawFeatureRegularPolygon"});var r=document.createElement("div");r.style.position="absolute";r.style.top="45px";r.style.right="120px";r.style.padding="10px";r.style.backgroundColor="#EFEFEF";r.style.display="none";r.style.zIndex=10;document.getElementById(this.container+"Outer").appendChild(r);var i=document.createElement("p");var s=document.createElement("span");s.innerHTML="Number of sides: ";i.appendChild(s);var o=document.createElement("input");o.type="text";o.id=this.container+"WIND-draw-Regular-Polygon-polysides";o.value=4;i.appendChild(o);r.appendChild(i);var u=document.createElement("p");var a=document.createElement("span");a.innerHTML="Irregularity: ";u.appendChild(a);var f=document.createElement("input");f.type="checkbox";f.id=this.container+"WIND-draw-Regular-Polygon-irregularpoly";u.appendChild(f);r.appendChild(u);var l=document.createElement("input");l.type="button";l.value="OK";r.appendChild(l);var c=document.createElement("input");c.type="button";c.value="Cancel";r.appendChild(c);this.drawRegularPolygonDiv=r;var h=this;l.onclick=function(){var e=parseInt(document.getElementById(h.container+"WIND-draw-Regular-Polygon-polysides").value);e=Math.max(3,isNaN(e)?0:e);h.drawRegularPolygon.handler.sides=e;var t=document.getElementById(h.container+"WIND-draw-Regular-Polygon-irregularpoly").checked;h.drawRegularPolygon.handler.irregular=t;h.drawRegularPolygonDiv.style.display="none"};c.onclick=function(){h.drawRegularPolygonDiv.style.display="none"};this.drawRegularPolygon.events.register("activate",this,function(){this.drawRegularPolygonDiv.style.display="block"});this.drawRegularPolygon.events.register("deactivate",this,function(){this.drawRegularPolygonDiv.style.display="none"});this.createMarker=new OpenLayers.Control.InsertIcon(this.vectorLayers[0],{title:"Créer un marqueur",displayClass:"olControlInsertIcon"});var p=document.createElement("div");p.style.position="absolute";p.style.top="45px";p.style.right="40px";p.style.padding="10px";p.style.backgroundColor="#EFEFEF";p.style.display="none";p.style.zIndex=10;document.getElementById(this.container+"Outer").appendChild(p);var i=document.createElement("p");var s=document.createElement("span");s.innerHTML="URL of icon: ";i.appendChild(s);var o=document.createElement("input");o.type="text";o.size="50";o.id=this.container+"WIND-create-Marker-Url";o.value=lib_path+"images/marker.png";i.appendChild(o);p.appendChild(i);var u=document.createElement("p");var a=document.createElement("span");a.innerHTML="Size: ";u.appendChild(a);var d=document.createElement("select");d.id=this.container+"WIND-create-Marker-Size";var v=document.createElement("option");v.text="Tiny";v.value=5;d.options.add(v);var m=document.createElement("option");m.selected=true;m.text="Small";m.value=15;d.options.add(m);var g=document.createElement("option");g.text="Normal";g.value=25;d.options.add(g);var y=document.createElement("option");y.text="Large";y.value=35;d.options.add(y);var b=document.createElement("option");b.text="Huge";b.value=45;d.options.add(b);u.appendChild(d);p.appendChild(u);var l=document.createElement("input");l.type="button";l.value="OK";p.appendChild(l);var c=document.createElement("input");c.type="button";c.value="Cancel";p.appendChild(c);this.createMarkerDiv=p;var h=this;l.onclick=function(){var e=document.getElementById(h.container+"WIND-create-Marker-Url").value;h.createMarker.iconURL=e;var t=parseInt(document.getElementById(h.container+"WIND-create-Marker-Size").value);h.createMarker.size=t;h.createMarkerDiv.style.display="none"};c.onclick=function(){h.createMarkerDiv.style.display="none"};this.createMarker.events.register("activate",this,function(){this.createMarkerDiv.style.display="block"});this.createMarker.events.register("deactivate",this,function(){this.createMarkerDiv.style.display="none"});this.reshapeFeature=new OpenLayers.Control.ModifyFeature(this.vectorLayers[0],{mode:OpenLayers.Control.ModifyFeature.RESHAPE,title:"Remodeler une figure",displayClass:"olControlReshapeFeature"});this.reshapeFeature.geometryTypes=["OpenLayers.Geometry.LineString","OpenLayers.Geometry.MultiLineString","OpenLayers.Geometry.Polygon","OpenLayers.Geometry.MultiPolygon"];this.resizeFeature=new OpenLayers.Control.ModifyFeature(this.vectorLayers[0],{mode:OpenLayers.Control.ModifyFeature.RESIZE,title:"Redimensionner une figure",displayClass:"olControlResizeFeature"});this.resizeFeature.geometryTypes=["OpenLayers.Geometry.LineString","OpenLayers.Geometry.MultiLineString","OpenLayers.Geometry.Polygon","OpenLayers.Geometry.MultiPolygon"];this.dragFeature=new OpenLayers.Control.ModifyFeature(this.vectorLayers[0],{mode:OpenLayers.Control.ModifyFeature.DRAG,title:"Déplacer une figure",displayClass:"olControlDragFeature"});this.rotateFeature=new OpenLayers.Control.ModifyFeature(this.vectorLayers[0],{mode:OpenLayers.Control.ModifyFeature.ROTATE,title:"Tourner une figure",displayClass:"olControlRotateFeature"});this.rotateFeature.geometryTypes=["OpenLayers.Geometry.LineString","OpenLayers.Geometry.MultiLineString","OpenLayers.Geometry.Polygon","OpenLayers.Geometry.MultiPolygon"];this.selectFeature=new OpenLayers.Control.SelectFeature(this.vectorLayers[0],{multiple:false,title:"Sélectionner une figure pour la mettre en form",displayClass:"olControlFormatFeature",onSelect:function(e){var t=document.createElement("div");t.style.fontSize="12px";if(e.style==null||e.style.externalGraphic==null){var n=document.createElement("p");var r=document.createElement("span");r.innerHTML="Stroke Color: ";n.appendChild(r);var i=document.createElement("input");i.id=h.container+"WIND-strokecolor";i.type="text";i.size=10;n.appendChild(i);var s=document.createElement("span");s.innerHTML=" Stroke Width: ";n.appendChild(s);var o=document.createElement("select");o.id=h.container+"WIND-strokewidth";for(var u=0;u<10;u++){var a=document.createElement("option");if(u==2)a.selected=true;else a.selected=false;a.text=u;a.value=u;o.options.add(a)}n.appendChild(o);var f=document.createElement("span");f.innerHTML=" Stroke Opacity: ";n.appendChild(f);var l=document.createElement("select");l.id=h.container+"WIND-strokeopacity";var a=document.createElement("option");a.text=1;a.value=1;l.options.add(a);for(var u=9;u>=0;u--){var a=document.createElement("option");a.text="0."+u;a.value=Number("0."+u);l.options.add(a)}n.appendChild(l);t.appendChild(n);var c=document.createElement("p");var p=document.createElement("span");p.innerHTML="Fill Color: ";c.appendChild(p);var d=document.createElement("input");d.id=h.container+"WIND-fillcolor";d.type="text";d.size=10;d.value="EE9900";c.appendChild(d);var v=document.createElement("span");v.innerHTML=" Fill Opacity: ";c.appendChild(v);var m=document.createElement("select");m.id=h.container+"WIND-fillopacity";var a=document.createElement("option");a.text=1;a.value=1;m.options.add(a);for(var u=9;u>=0;u--){var a=document.createElement("option");a.text="0."+u;a.value=Number("0."+u);m.options.add(a)}c.appendChild(m);t.appendChild(c);var g=document.createElement("input");g.id=h.container+"updateFeatureButton";g.type="button";g.value="Update";t.appendChild(g)}else{var n=document.createElement("p");var y=document.createElement("span");y.innerHTML="URL of icon: ";n.appendChild(y);var b=document.createElement("input");b.type="text";b.size="50";b.id=h.container+"WIND-iconurl";n.appendChild(b);t.appendChild(n);var c=document.createElement("p");var w=document.createElement("span");w.innerHTML="Size: ";c.appendChild(w);var E=document.createElement("select");E.id=h.container+"WIND-iconsize";var S=document.createElement("option");S.text="Tiny";S.value=5;E.options.add(S);var x=document.createElement("option");x.text="Small";x.value=15;E.options.add(x);var T=document.createElement("option");T.text="Normal";T.value=25;E.options.add(T);var N=document.createElement("option");N.text="Large";N.value=35;E.options.add(N);var C=document.createElement("option");C.text="Huge";C.value=45;E.options.add(C);c.appendChild(E);t.appendChild(c);var g=document.createElement("input");g.id=h.container+"updateFeatureButton";g.type="button";g.value="Update";t.appendChild(g)}h.popupDiv=t;var k=new OpenLayers.Popup.FramedCloud("mypopup",e.geometry.getBounds().getCenterLonLat(),null,t.innerHTML,null,true,false);e.popup=k;h.olMap.addPopup(k);h.selectedFeature=e;if(e.style==null||e.style.externalGraphic==null){document.getElementById(h.container+"WIND-strokecolor").value=e.style!=null&&e.style.strokeColor!=null?e.style.strokeColor:"#0033CC";document.getElementById(h.container+"WIND-strokewidth").options[e.style!=null&&e.style.strokeWidth!=null?e.style.strokeWidth:2].selected=true;document.getElementById(h.container+"WIND-strokeopacity").options[10-10*Number(e.style!=null&&e.style.strokeOpacity!=null?e.style.strokeOpacity:1)].selected=true;document.getElementById(h.container+"WIND-fillcolor").value=e.style!=null&&e.style.fillColor!=null?e.style.fillColor:"#809FFE";document.getElementById(h.container+"WIND-fillopacity").options[10-10*Number(e.style!=null&&e.style.fillOpacity!=null?e.style.fillOpacity:.5)].selected=true}else{document.getElementById(h.container+"WIND-iconurl").value=e.style.externalGraphic;document.getElementById(h.container+"WIND-iconsize").options[Math.floor((Number(e.style.pointRadius)-5)/10)].selected=true}document.getElementById(h.container+"updateFeatureButton").onclick=function(){if(e.style==null||e.style.externalGraphic==null){var t=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);t.strokeColor=document.getElementById(h.container+"WIND-strokecolor").value;t.strokeWidth=parseInt(document.getElementById(h.container+"WIND-strokewidth").value);t.strokeOpacity=parseFloat(document.getElementById(h.container+"WIND-strokeopacity").value);t.fillColor=document.getElementById(h.container+"WIND-fillcolor").value;t.fillOpacity=parseFloat(document.getElementById(h.container+"WIND-fillopacity").value);e.style=t;h.vectorLayers[0].drawFeature(e);h.olMap.removePopup(e.popup)}else{var t=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);t.externalGraphic=document.getElementById(h.container+"WIND-iconurl").value;var n=parseInt(document.getElementById(h.container+"WIND-iconsize").value);t.pointRadius=n;t.graphicXOffset=-1*n;t.graphicYOffset=-2*n;t.fillOpacity=1;e.style=t;h.vectorLayers[0].drawFeature(e);h.olMap.removePopup(e.popup)}}},onUnselect:function(e){h.olMap.removePopup(e.popup)}});this.removeFeature=new OpenLayers.Control.SelectFeature(this.vectorLayers[0],{multiple:false,title:"Supprimer une figure de la carte",displayClass:"olControlRemoveFeature",onSelect:function(e){if(confirm("Vous voulez supprimer cette figure?")){for(var t=0;t<h.parts.length;t++){var n=h.parts[t].feature.geometry.clone();n.transform(new OpenLayers.Projection("EPSG:4326"),h.olMap.baseLayer.projection);if(comparerGeo(n,e.geometry)){var r=h.parts.slice(0,t);var i=h.parts.slice(t+1);h.parts=r.concat(i);h.vectorLayers[0].removeFeatures([e]);break}}}}});this.toolbar.addControls([this.mousecontrol,this.drawPoint,this.drawLine,this.drawPolygon,this.drawRegularPolygon,this.createMarker,this.reshapeFeature,this.resizeFeature,this.dragFeature,this.rotateFeature,this.selectFeature,this.removeFeature]);this.olMap.addControl(this.toolbar)}var h=this;this.vectorLayers[0].onFeatureInsert=function(e){var t=e.geometry.clone();t.transform(h.olMap.baseLayer.projection,new OpenLayers.Projection("EPSG:4326"));if(e.style&&e.style.externalGraphic){var n=t.toString().length;if(t instanceof OpenLayers.Geometry.Collection){var r="MULTIMARKER("+t.toString().substring(10)+", "+e.style.externalGraphic+")";h.parts.push(new WIND.Map.Part(r))}else{var r="MARKER("+t.toString().substring(5)+", "+e.style.externalGraphic+")";h.parts.push(new WIND.Map.Part(r))}}else h.parts.push(new WIND.Map.Part(t.toString()));h.onPartInsert()};this.modifyingPartIndex=0;this.vectorLayers[0].events.on({beforefeaturemodified:function(e){for(var t=0;t<h.parts.length;t++){var n=h.parts[t].feature.geometry.clone();n.transform(new OpenLayers.Projection("EPSG:4326"),h.olMap.baseLayer.projection);if(comparerGeo(n,e.feature.geometry)){h.modifyingPartIndex=t}}},afterfeaturemodified:function(e){var t=e.feature.geometry.clone();t.transform(h.olMap.baseLayer.projection,new OpenLayers.Projection("EPSG:4326"));h.parts[h.modifyingPartIndex].geoObject=t.toString();h.parts[h.modifyingPartIndex].feature=new OpenLayers.Feature.Vector(t,{},h.parts[h.modifyingPartIndex].style)}})};WIND.Map.prototype.onPartInsert=function(){};OpenLayers.Control.InsertIcon=OpenLayers.Class(OpenLayers.Control,{iconURL:lib_path+"images/marker.png",size:15,defaultHandlerOptions:{single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false},initialize:function(e,t){if(t.iconURL)this.iconURL=t.iconURL;if(t.size)this.size=t.size;this.vectorLayer=e;this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,[t]);this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions);this.title=t.title;this.displayClass=t.displayClass},trigger:function(e){var t=this.vectorLayer.map.getLonLatFromViewPortPx(e.xy);var n=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);n.externalGraphic=this.iconURL;n.pointRadius=this.size;n.graphicXOffset=-1*this.size;n.graphicYOffset=-2*this.size;n.fillOpacity=1;var r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{},n);this.vectorLayer.addFeatures([r])}});WIND.Map.prototype.removeToolBar=function(){if(this.toolbar!=null){this.olMap.removeControl(this.toolbar);this.toolbar=null;document.getElementById(this.container+"Outer").removeChild(this.toolbardiv)}};WIND.Map.prototype.addLocationBar=function(){if(this.locationBar==null){var e=document.createElement("div");e.style.position="absolute";e.style.bottom="2px";e.style.left="2px";e.style.zIndex=10;var t=this;var n="<input type='text' id='lbaddress' size='10'> ";n+="<input type='button' id='lbsubmit' value='Search'>";e.innerHTML=n;document.getElementById(this.container+"Outer").appendChild(e);document.getElementById("lbsubmit").onclick=function(){if(document.getElementById("lbaddress").value){var e=WIND.Map.searchLocation(document.getElementById("lbaddress").value,false);for(var n=0;n<e.length;n++)t.addMarker(new WIND.Map.Marker(e[n]))}else alert("Please entre a location!")};this.locationBar=e}else this.locationBar.style.visibility="visible"};WIND.Map.prototype.removeLocationBar=function(){if(this.locationBar!=null)this.locationBar.style.visibility="hidden"};WIND.Map.prototype.addItineraryBar=function(){if(this.itineraryBar==null){var e=document.createElement("div");e.style.position="absolute";e.style.bottom="2px";e.style.right="2px";e.style.zIndex=10;var t=this;var n="<input type='text' id='ibitinerary' size='20' value='from:Bayonne to:Dax to:Pau'> route<input type='checkbox' id='itimode'>";n+="<input type='button' id='ibsubmit' value='Itinerary'>";e.innerHTML=n;document.getElementById(this.container+"Outer").appendChild(e);document.getElementById("ibsubmit").onclick=function(){if(document.getElementById("ibitinerary").value){var e=document.getElementById("ibitinerary").value.split(" ");var n=[];var r="";for(var i=0;i<e.length;i++){r=e[i];if(r.startsWith("from:"))r=r.substring(5,r.length);else if(r.startsWith("from"))r=r.substring(4,r.length);else if(r.startsWith("to:"))r=r.substring(3,r.length);else if(r.startsWith("to"))r=r.substring(2,r.length);n.push(r)}var e=WIND.Map.searchItinerary(n);if(document.getElementById("itimode").checked)t.addItinerary(e,{mode:"route",color:"blue"});else t.addItinerary(e,{mode:"direct",color:"blue"})}else alert("Please entre an itinerary!")};this.itineraryBar=e}else this.itineraryBar.style.visibility="visible"};WIND.Map.prototype.removeItineraryBar=function(){if(this.itineraryBar!=null)this.itineraryBar.style.visibility="hidden"};WIND.Map.prototype.initialize=function(){for(var e=0;e<this.vectorLayers.length;e++)this.vectorLayers[e].destroyFeatures();this.annotations=[];this.parts=[]};WIND.Map.prototype.destroy=function(){this.scaleControl=null;this.positionControl=null;this.mouseControl=null;this.keyboardControl=null;this.zoomControl=null;this.switcher=null;this.toolbar=null;this.locationbar=null;this.itinerarybar=null;var e=document.getElementById(this.container+"Outer");if(this.parentEl){var t=[];for(var n=0;n<this.parentDocument.viewers.length;n++){if(this.parentDocument.viewers[n].container!=this.container){t.push(this.parentDocument.viewers[n])}}this.parentDocument.viewers=t;document.getElementById(this.parentEl).removeChild(e)}else document.body.removeChild(e)};WIND.Map.prototype.removeLayer=function(e){var t=new Array;var n=false;for(var r=0;r<this.typeList.length;r++){if(this.typeList[r]==e){n=true}else{t.push(this.typeList[r])}}if(n){this.typeList=t;var i=this.switcher.getElementsByTagName("input");for(var r=0;r<i.length;r++){if(i[r].type=="radio"&&i[r].value==e){var s=i[r].nextSibling;var o=s.nextSibling;this.switcher.removeChild(i[r]);this.switcher.removeChild(s);this.switcher.removeChild(o);break}}if(e==this.olMap.baseLayer.name){this.changeBaseLayer(this.typeList[0]);var i=this.switcher.getElementsByTagName("input");for(var r=0;r<i.length;r++){if(i[r].type=="radio"&&i[r].value==this.typeList[0]){i[r].checked="checked";break}}}if(this.typeList.length==1)this.removeSwitcher()}};WIND.Map.prototype.addLayer=function(e,t){if(this.typeList.join().indexOf(e)<0){var n=this;this.typeList.push(e);if(this.typeList.length>1&&this.switcher==null)this.addSwitcher();else if(this.switcher!=null){var r=this.switcher;if(!e.startsWith("IGN")){var i=document.createElement("input");i.setAttribute("type","radio");i.setAttribute("name","layerchoice");i.setAttribute("value",e);i.onclick=function(){n.changeBaseLayer(this.value);if(n.ignLayersDiv)n.ignLayersDiv.style.display="none"};r.appendChild(i);r.appendChild(document.createTextNode(e));r.appendChild(document.createElement("br"))}else if(!this.ignLayersDiv){var i=document.createElement("input");i.setAttribute("type","radio");i.setAttribute("name","layerchoice");i.setAttribute("value","IGN Maps");r.appendChild(i);r.appendChild(document.createTextNode("IGN Maps"));r.appendChild(document.createElement("br"));var s=document.createElement("div");s.style.position="relative";s.style.left="5px";if(i.checked)s.style.display="block";else s.style.display="none";var o=document.createElement("input");o.setAttribute("type","checkbox");o.setAttribute("value",e);o.checked=true;s.appendChild(o);s.appendChild(document.createTextNode(e));s.appendChild(document.createElement("br"));r.appendChild(s);this.ignLayersDiv=s;i.onclick=function(){n.ignLayersDiv.style.display="block";n.changeBaseLayer(this.value)};this.ignBaseLayer=e;var u;o.onclick=function(){for(var e=0;e<n.olMap.layers.length;e++){if(n.olMap.layers[e].name==this.value){u=n.olMap.layers[e]}}if(this.checked)u.setVisibility(true);else u.setVisibility(false)}}else{var o=document.createElement("input");o.setAttribute("type","checkbox");o.setAttribute("value",e);o.checked=false;this.ignLayersDiv.appendChild(o);this.ignLayersDiv.appendChild(document.createTextNode(e));this.ignLayersDiv.appendChild(document.createElement("br"));var u;o.onclick=function(){for(var e=0;e<n.olMap.layers.length;e++){if(n.olMap.layers[e].name==this.value){u=n.olMap.layers[e]}}if(this.checked)u.setVisibility(true);else u.setVisibility(false)}}}var a;var f=new OpenLayers.Projection("IGNF:GEOPORTALFXX");switch(e){case"Google Street":a=new OpenLayers.Layer.Google("Google Street",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),sphericalMercator:true});break;case"Google Street Edit":a=new OpenLayers.Layer.Google("Google Street Edit",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),type:G_MAPMAKER_NORMAL_MAP,sphericalMercator:true});break;case"Google Hybrid":a=new OpenLayers.Layer.Google("Google Hybrid",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),type:google.maps.MapTypeId.HYBRID,sphericalMercator:true});break;case"Google Hybrid Edit":a=new OpenLayers.Layer.Google("Google Hybrid Edit",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),type:G_MAPMAKER_HYBRID_MAP,sphericalMercator:true});break;case"Google Satellite":a=new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:22});break;case"Google Terrain":a=new OpenLayers.Layer.Google("Google Terrain",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),type:google.maps.MapTypeId.TERRAIN,sphericalMercator:true});break;case"Virtual Earth Roads":a=new OpenLayers.Layer.VirtualEarth("Virtual Earth Roads",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),type:VEMapStyle.Road,sphericalMercator:true});break;case"Virtual Earth Hybrid":a=new OpenLayers.Layer.VirtualEarth("Virtual Earth Hybrid",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),type:VEMapStyle.Hybrid,sphericalMercator:true});break;case"Virtual Earth Aerial":a=new OpenLayers.Layer.VirtualEarth("Virtual Earth Aerial",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),type:VEMapStyle.Aerial,sphericalMercator:true});break;case"Yahoo Street":a=new OpenLayers.Layer.Yahoo("Yahoo Street",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),sphericalMercator:true});break;case"Yahoo Hybrid":a=new OpenLayers.Layer.Yahoo("Yahoo Hybrid",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),type:YAHOO_MAP_HYB,sphericalMercator:true});break;case"Yahoo Satellite":a=new OpenLayers.Layer.Yahoo("Yahoo Satellite",{projection:new OpenLayers.Projection("EPSG:900913"),units:"m",numZoomLevels:22,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),type:YAHOO_MAP_SAT,sphericalMercator:true});break;case"IGN Route":var l={name:"IGN Route",url:"http://gpp3-wxs.ign.fr/"+IGN_key+"/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.MAPS",matrixSet:"PM",style:"normal",numZoomLevels:19,attribution:'Map base: &copy;IGN <a href="http://www.geoportail.fr/" target="_blank"><img src="http://api.ign.fr/geoportail/api/js/2.0.0beta/theme/geoportal/img/logo_gp.gif"></a> <a href="http://www.geoportail.gouv.fr/depot/api/cgu/licAPI_CGUF.pdf" alt="TOS" title="TOS" target="_blank">Terms of Service</a>'};a=new OpenLayers.Layer.WMTS(l);break;case"IGN Satellite":var l={name:"IGN Satellite",url:"http://gpp3-wxs.ign.fr/"+IGN_key+"/wmts",layer:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",style:"normal",numZoomLevels:20,attribution:'Map base: &copy;IGN <a href="http://www.geoportail.fr/" target="_blank"><img src="http://api.ign.fr/geoportail/api/js/2.0.0beta/theme/geoportal/img/logo_gp.gif"></a> <a href="http://www.geoportail.gouv.fr/depot/api/cgu/licAPI_CGUF.pdf" alt="TOS" title="TOS" target="_blank">Terms of Service</a>'};a=new OpenLayers.Layer.WMTS(l);if(this.typeList.join().indexOf("IGN Route")!=-1)a.setVisibility(false);break;case"OpenStreetMap":a=new OpenLayers.Layer.OSM;break;case"Bing Road":a=new OpenLayers.Layer.Bing({name:"Bing Road",key:BING_key,type:"Road"});break;case"Bing Hybrid":a=new OpenLayers.Layer.Bing({name:"Bing Hybrid",key:BING_key,type:"AerialWithLabels"});break;case"Bing Aerial":a=new OpenLayers.Layer.Bing({name:"Bing Aerial",key:BING_key,type:"Aerial"});break}if(a.name==this.ignBaseLayer||t){a.isBaseLayer=true}this.olMap.addLayer(a);if(t){this.olMap.baseLayer=a}var c=this.olMap.baseLayer.name;if(c.indexOf("Google")!=-1||c.indexOf("Virtual Earth")!=-1||c.indexOf("Yahoo")!=-1){if(a.name.indexOf("IGN")!=-1){a.alwaysInRange=false}}}};WIND.Map.prototype.addLayers=function(e){for(var t=0,n=e.length;t<n;t++)this.addLayer(e[t])};WIND.Map.prototype.changeBaseLayer=function(e){if(e.indexOf("Google")!=-1||e.indexOf("Virtual Earth")!=-1||e.indexOf("Yahoo")!=-1){var t=this.olMap.layers.length;for(var n=0;n<t;n++){if(this.olMap.layers[n].name.indexOf("IGN")!=-1){this.olMap.layers[n].alwaysInRange=false}}}if(e.indexOf("IGN Maps")!=-1){e=this.ignBaseLayer;var r=this.ignLayersDiv.getElementsByTagName("input");for(var n=0;n<r.length;n++){if(r[n].type=="checkbox"&&r[n].value==this.ignBaseLayer)r[n].checked=true}var t=this.olMap.layers.length;for(var n=0;n<t;n++){if(this.olMap.layers[n].name.indexOf("IGN")!=-1){this.olMap.layers[n].alwaysInRange=true}}}var i=null;var s=null;var o=null;if(this.olMap.baseLayer){i=this.olMap.baseLayer;s=this.olMap.getProjectionObject();o=this.olMap.baseLayer.getExtent()}var u;for(var n=0;n<this.olMap.layers.length;n++){if(this.olMap.layers[n].name==e)u=this.olMap.layers[n]}if(e!=this.olMap.baseLayer.name){if(OpenLayers.Util.indexOf(this.olMap.layers,u)!=-1){if(this.olMap.baseLayer!=null)this.olMap.baseLayer.setVisibility(false);this.olMap.baseLayer=u;this.olMap.viewRequestID++;this.olMap.baseLayer.visibility=true;if(s&&s.getCode()!=this.olMap.getProjectionObject().getCode()){o.transform(s,this.olMap.baseLayer.projection);this.olMap.zoomToExtent(o);if(i.name.indexOf("IGN")!=-1&&(e.indexOf("Google")!=-1||e.indexOf("Virtual Earth")!=-1||e.indexOf("Yahoo")!=-1)){this.olMap.zoomIn(1)}if(this.toolbar)this.parts=[];if(this.vectorLayers){var a=[];var f=[];var l;var c;for(var h=0;h<this.vectorLayers.length;h++){for(var n=0;n<this.vectorLayers[h].features.length;n++){l=this.vectorLayers[h].features[n].geometry.clone();c=this.vectorLayers[h].features[n].style;l[h].transform(s,this.olMap.baseLayer.projection);f.push(new OpenLayers.Feature.Vector(l,{},c))}a.push(f)}for(var h=0;h<this.vectorLayers.length;h++){this.vectorLayers[h].destroyFeatures();this.vectorLayers[h].addFeatures(a[h])}}}else{var p=this.olMap.getCenter();if(p!=null){var d=o?o.getCenterLonLat():p;d.transform(s,this.olMap.getProjectionObject());var v=typeof zoom=="number"?zoom:o?this.olMap.getZoomForExtent(o,true):this.olMap.getZoomForResolution(this.olMap.resolution,true);this.olMap.setCenter(d,v,false,true)}}}}};WIND.Map.prototype.SelectVectorLayer=function(e,t){var n=false;var r=0;var i=0;if(t!=null)n=t;if(e instanceof Array){var s;var o=[];for(var u=0;u<e.length;u++){s=e[u];if(this.vlIndex.indexOf(s)>=0){o.push(e[u])}}for(var a=0;a<o.length;a++){o[a]=m.vectorLayers[o[a]];r+=o[a].features.length}this.selectControl.setLayer(o);if(n){for(var u=m.vectorLayers.length-1;u>=0;u--){if(o.indexOf(m.vectorLayers[u])>=0){for(var a=0;a<m.vectorLayers[u].features.length;a++){m.vectorLayers[u].features[a].style.strokeOpacity=1;m.vectorLayers[u].features[a].style.fillOpacity=.9-.2/(r-1)*i;i++}}else{for(var a=0;a<m.vectorLayers[u].features.length;a++){m.vectorLayers[u].features[a].style.strokeOpacity=0;m.vectorLayers[u].features[a].style.fillOpacity=.3}}m.vectorLayers[u].redraw()}}}else{if(this.vlIndex.indexOf(e)>=0){this.selectControl.setLayer(m.vectorLayers[e]);if(n){for(var u=0;u<m.vectorLayers.length;u++){if(u!=e){for(var a=0;a<m.vectorLayers[u].features.length;a++)m.vectorLayers[u].features[a].style.strokeOpacity=0}else{for(var a=0;a<m.vectorLayers[e].features.length;a++)m.vectorLayers[e].features[a].style.strokeOpacity=1}m.vectorLayers[u].redraw()}}}}};WIND.Map.prototype.addVectorLayer=function(e){if(this.vlIndex.indexOf(e)<0&&Number.isInteger(e)){var t=new OpenLayers.Layer.Vector("Vector Layer "+e);this.olMap.addLayer(t);this.vectorLayers[e]=t;this.vlIndex.push(e)}};WIND.Map.prototype.addSensiblePartToLayer=function(e,t,n){var r;if(!t||!this.vlIndex.indexOf(t))r=0;else r=t;var i,s;var o=true;s=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);if(n){if(n.projection){i=n.projection}if(n.style){var u=n.style;var a=u.split(",");var f;for(var l=0;l<a.length;l++){f=a[l];switch(f.split(":")[0]){case"strokeColor":s.strokeColor=f.split(":")[1];break;case"strokeWidth":s.strokeWidth=f.split(":")[1];break;case"strokeOpacity":s.strokeOpacity=f.split(":")[1];break;case"fillColor":s.fillColor=f.split(":")[1];break;case"fillOpacity":s.fillOpacity=f.split(":")[1];break}}}if(n.display){o=n.display}}var c=new WIND.Map.Part(e,i,s);c.viewer=this;c.vlayer=this.vectorLayers[r];c.object=id_annot;this.parts.push(c);if(o){var h=c.feature.geometry.clone();h.transform(new OpenLayers.Projection("EPSG:4326"),this.olMap.baseLayer.projection);var p=new OpenLayers.Feature.Vector(h,{},c.feature.style);this.vectorLayers[r].addFeatures([p])}return c};WIND.Map.prototype.addSensiblePart=function(e,t,n){var r;if(!n||!this.vlIndex.indexOf(n))r=0;else r=n;e.viewer=this;e.vlayer=this.vectorLayers[r];this.parts.push(e);if(t){var i=e.feature.geometry.clone();i.transform(new OpenLayers.Projection("EPSG:4326"),this.olMap.baseLayer.projection);var s=new OpenLayers.Feature.Vector(i,{},e.feature.style);this.vectorLayers[r].addFeatures([s])}};WIND.Map.prototype.render=function(){var e,t,n;if(this.longitude||this.longitude==0){e=this.longitude}else{e=-1.508585}if(this.latitude||this.latitude==0){t=this.latitude}else{t=43.477743}if(this.zoom||this.zoom==0){n=this.zoom}else{n=4}OpenLayers.IMAGE_RELOAD_ATTEMPTS=10;OpenLayers.Feature.Vector.style["default"].strokeWidth=10;OpenLayers.Util.onImageLoadErrorColor="transparent";this.olMap=new OpenLayers.Map(this.container,{zoomDuration:10,controls:[],projection:"EPSG:900913",restrictedExtent:null});this.addScaleControl();this.addPositionControl();if(this.zoomable==true&&this.pannable==true){this.setMouseControl({zoomWheelEnabled:true,zoomBoxEnabled:true,zoomDbClickEnabled:true,panEnabled:true});this.addZoomControl()}this.addLayer(this.baseLayer,true);var r=new OpenLayers.LonLat(e,t);r.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));this.olMap.setCenter(r,n);this.vectorLayers[0]=new OpenLayers.Layer.Vector("Vector Layer");this.olMap.addLayer(this.vectorLayers[0]);this.vlIndex.push(0);this.selectControl=new OpenLayers.Control.SelectFeature([this.vectorLayers[0]]);this.olMap.addControl(this.selectControl);this.selectControl.activate();this.evtclick=new OpenLayers.Control.Click(this);this.olMap.addControl(this.evtclick);this.evtclick.activate();this.evthover=new OpenLayers.Control.Hover(this);this.olMap.addControl(this.evthover);this.evthover.activate();vector_layer_id="OpenLayers_Layer_Vector_31_vroot";var i=document.getElementsByTagName("g");for(var s=0;s<i.length;s++){if(i[s].id.indexOf("OpenLayers_Layer_Vector")!=-1&&i[s].id.indexOf("_vroot")!=-1&&i[s].id.indexOf("RootContainer")==-1){vector_layer_id=i[s].id;break}}};OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:true,"double":false,pixelTolerance:10,stopSingle:false,stopDouble:false},initialize:function(e,t){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions);this.windMap=e},trigger:function(e){var t=this.windMap;var n=this;var r=t.olMap.getLonLatFromViewPortPx(e.xy);var i=new OpenLayers.Geometry.Point(r.lon,r.lat);i.transform(t.olMap.baseLayer.projection,new OpenLayers.Projection("EPSG:4326"));for(var s=0;s<t.interactionList.length;s++){var o=t.interactionList[s];var u=o.event;var a=o.source[0].feature.geometry;var f=o.reactions;for(var l=0;l<f.length;l++){var c=f[l].target;if(c instanceof WIND.LiveSensiblePart){var h;for(var p=0;p<n.parts.length;p++){if(u=="click"&&i.intersects(n.parts[p].feature.geometry)||pointNearByLine(i,n.parts[p].feature.geometry)||comparerPoint(i,n.parts[p].feature.geometry)){h=n.parts[p];break}}if(h){var d=c.viewer;var v=c.func;var m=d.annotations;for(var g=0;g<m.length;g++){if(m[g].semantics==h.annotation.semantics&&m[g].entity==h.annotation.entity){if(v=="prefecture_of_town"){var y=createXHR();y.onreadystatechange=function(){if(y.readyState==4){if(y.status==200){var e=y.responseXML;var t=e.getElementsByTagName("geoname")[0];var n;if(d instanceof WIND.Map){n=d.createAnnotation("http://geotopia.univ-pau.fr/GeotopiaService#Department",t.getElementsByTagName("nom_chf_l")[0].childNodes[0].nodeValue,t.getElementsByTagName("astext")[0].textContent,{style:"strokeColor:#0033CC,strokeWidth:2,fillColor:#809FFE"})}else if(d instanceof WIND.Text){var r=document.getElementById(d.container);while(r.firstChild){r.removeChild(r.firstChild)}document.getElementById(d.container).innerHTML="";d.paragraphs=[];var i=d.createParagraph();i.setContent(t.getElementsByTagName("nom_chf_l")[0].childNodes[0].nodeValue);n=d.createAnnotation("http://geotopia.univ-pau.fr/GeotopiaService#Department",t.getElementsByTagName("nom_chf_l")[0].childNodes[0].nodeValue,1,1,1)}var s=n.annotedObjects;for(var o=0;o<s.length;o++){s[o].callFunction(f[l].calledFunction,f[l].parameters)}}}};y.open("GET",lib_path+"php/prefecture_of_town.php?place="+m[g].entity,false);y.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8");y.send(null)}else if(v=="prefecture_of_department"){var y=createXHR();y.onreadystatechange=function(){if(y.readyState==4){if(y.status==200){var e=y.responseXML;var t=e.getElementsByTagName("geoname")[0];var n;if(d instanceof WIND.Map){n=d.createAnnotation("http://geotopia.univ-pau.fr/GeotopiaService#Department",t.getElementsByTagName("nom_chf_l")[0].childNodes[0].nodeValue,t.getElementsByTagName("astext")[0].textContent,{style:"strokeColor:#0033CC,strokeWidth:2,fillColor:#809FFE"})}else if(d instanceof WIND.Text){var r=document.getElementById(d.container);while(r.firstChild){r.removeChild(r.firstChild)}document.getElementById(d.container).innerHTML="";d.paragraphs=[];var i=d.createParagraph();i.setContent(t.getElementsByTagName("nom_chf_l")[0].childNodes[0].nodeValue);n=d.createAnnotation("http://geotopia.univ-pau.fr/GeotopiaService#Department",t.getElementsByTagName("nom_chf_l")[0].childNodes[0].nodeValue,1,1,1)}var s=n.annotedObjects;for(var o=0;o<s.length;o++){s[o].callFunction(f[l].calledFunction,f[l].parameters)}}}};y.open("GET",lib_path+"php/prefecture_of_department.php?place="+m[g].entity,false);y.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8");y.send(null)}else if(v=="department_of_town"){var y=createXHR();y.onreadystatechange=function(){if(y.readyState==4){if(y.status==200){var e=y.responseXML;var t=e.getElementsByTagName("geoname")[0];var n;if(d instanceof WIND.Map){n=d.createAnnotation("http://geotopia.univ-pau.fr/GeotopiaService#Department",t.getElementsByTagName("nom_dept")[0].childNodes[0].nodeValue,t.getElementsByTagName("astext")[0].textContent,{style:"strokeColor:#0033CC,strokeWidth:2,fillColor:#809FFE"})}else if(d instanceof WIND.Text){var r=document.getElementById(d.container);while(r.firstChild){r.removeChild(r.firstChild)}document.getElementById(d.container).innerHTML="";d.paragraphs=[];var i=d.createParagraph();i.setContent(t.getElementsByTagName("nom_dept")[0].childNodes[0].nodeValue);n=d.createAnnotation("http://geotopia.univ-pau.fr/GeotopiaService#Department",t.getElementsByTagName("nom_dept")[0].childNodes[0].nodeValue,1,1,1)}var s=n.annotedObjects;for(var o=0;o<s.length;o++){s[o].callFunction(f[l].calledFunction,f[l].parameters)}}}};y.open("GET",lib_path+"php/department_of_town.php?place="+m[g].entity,false);y.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8");y.send(null)}else{var b=m[g].annotedObjects;for(var w=0;w<b.length;w++){b[w].callFunction(f[l].calledFunction,f[l].parameters)}}break}}}}else{c.callFunction(f[l].calledFunction,f[l].parameters)}}}}});OpenLayers.Control.Hover=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{delay:500,pixelTolerance:null,stopMove:false},initialize:function(e,t){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Hover(this,{pause:this.onPause,move:this.onMove},this.handlerOptions);this.windMap=e},onPause:function(e){var t=this.windMap;var n=t.olMap.getLonLatFromViewPortPx(e.xy);var r=new OpenLayers.Geometry.Point(n.lon,n.lat);r.transform(t.olMap.baseLayer.projection,new OpenLayers.Projection("EPSG:4326"));for(var i=0;i<t.interactionList.length;i++){var s=t.interactionList[i];var o=s.event;var u=s.source[0].feature;var a=u.geometry;var f=s.reactions;if(o=="mouseover"&&(r.intersects(a)||pointNearByLine(r,a)||comparerPoint(r,a))){for(var l=0;l<f.length;l++){f[l].target.callFunction(f[l].calledFunction,f[l].parameters)}}}},onMove:function(e){}});WIND.Map.searchLocation=function(e,t){var n=createXHR();var r=WIND.getScriptLocation();if(r!=0&&!r.endsWith("/")){r+="/"}if(t){var i=null;n.open("POST",r+"php/geonames.php",false);n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");n.send("place="+e+"&p=1");if(n.status==200){var s=n.responseXML.getElementsByTagName("geoname");for(var o=0;o<s.length;o++){if(e==s[o].getElementsByTagName("name")[0].firstChild.nodeValue){var u=s[o].getElementsByTagName("lng")[0].firstChild.nodeValue;var a=s[o].getElementsByTagName("lat")[0].firstChild.nodeValue;i=new OpenLayers.Geometry.Point(u,a);break}}}else{alert("Error: "+n.status+" "+n.statusText)}return i}else{var f=[];n.open("POST",lib_path+"php/geonames.php",false);n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");n.send("place="+e+"&p=0");if(n.status==200){var s=n.responseXML.getElementsByTagName("geoname");for(var o=0;o<s.length;o++){var u=s[o].getElementsByTagName("lng")[0].firstChild.nodeValue;var a=s[o].getElementsByTagName("lat")[0].firstChild.nodeValue;f.push(new OpenLayers.Geometry.Point(u,a))}}else{alert("Error: "+n.status+" "+n.statusText)}return f}};WIND.Map.searchItinerary=function(e){if(e.length>1){var t=[];for(var n=0;n<e.length;n++){var r=WIND.Map.searchLocation(e[n]);if(r!=null)t.push(r)}return new WIND.Map.Itinerary(t)}else return null};WIND.Map.prototype.loadXMLFile=function(e){var t=createXHR();t.open("GET",e,false);t.send(null);if(t.status==200){var n=t.responseXML;var r=n.getElementsByTagName("Annotation");for(var i=0;i<r.length;i++){var s=r[i].getAttribute("id");if(s){var o=[];var u=r[i].getElementsByTagName("Itinerary");if(u.length>0){var a=u[0];var f=a.getElementsByTagName("MapPart");var l=[];for(var c=0;c<f.length;c++){var h=f[c];var p=h.getElementsByTagName("geolocation")[0].firstChild.nodeValue;var d=p.substring(6,p.length-1);var v=d.split(" ")[0];var m=d.split(" ")[1];l.push(new OpenLayers.Geometry.Point(v,m))}var a=new WIND.Map.Itinerary(l);o.push(a);this.addItinerary(a,{mode:"route",color:"blue"})}else{var g=r[i].getElementsByTagName("MapPart");for(var c=0;c<g.length;c++){var y=g[c].getElementsByTagName("geolocation")[0].textContent;var b=null;var w=g[c].getElementsByTagName("geoname");if(w.length>0&&w[0].firstChild)b=w[0].firstChild.nodeValue;var E=this.createSensiblePart(y,{geoname:b,style:"strokeColor:#0033CC,strokeWidth:3,fillColor:#FF9900"});o.push(E)}}if(o.length>0){var S=new WIND.Annotation(r[i].getElementsByTagName("semantics")[0].firstChild.nodeValue,r[i].getElementsByTagName("entity")[0].firstChild.nodeValue,o);this.annotations.push(S)}}}this.zoomToExtent(this.parts)}else{document.getElementById(this.container).innerHTML="Error: "+e+" "+t.status+" "+t.statusText}};WIND.Map.prototype.loadRDFFile=function(e,t){var n=createXHR();n.open("GET",e+"?rdf="+t,false);n.send(null);if(n.status==200){var r=YAHOO.lang.JSON.parse(n.responseText);if(r.itinerary&&r.itinerary.length>0){var i=r.itinerary;var s=[];for(var o=0;o<i.length;o++){var u=i[o];var a=u.geolocation;var f=a.substring(6,a.length-1);var l=f.split(" ")[0];var c=f.split(" ")[1];s.push(new OpenLayers.Geometry.Point(l,c))}var h=new WIND.Map.Itinerary(s);this.addItinerary(h,{mode:"route",color:"blue"})}else{var p=r.annotations;for(var d=0;d<p.length;d++){var v=p[d].spatialInfo;for(var o=0;o<v.length;o++){var m=this.createSensiblePart(v[o].geolocation,{geoname:v[o].geoname,style:"strokeColor:#0033CC,strokeWidth:3,fillColor:#FF9900,fillOpacity:0.3"});var g=new WIND.Annotation(v[o].geotype,v[o].geoname,[m]);this.annotations.push(g)}}this.zoomToExtent(this.parts)}}else{document.getElementById(this.container).innerHTML="Error: "+t+" "+n.status+" "+n.statusText}};WIND.Map.prototype.createSensiblePart=function(e,t,n){var r;if(!n||!this.vlIndex.indexOf(n))r=0;else r=n;var i,s;var o=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);var u=true;if(t){if(t.projection){i=t.projection}if(t.style){var a=t.style;var f=a.split(",");var l;for(var c=0;c<f.length;c++){l=f[c];switch(l.split(":")[0]){case"strokeColor":o.strokeColor=l.split(":")[1];break;case"strokeWidth":o.strokeWidth=l.split(":")[1];break;case"strokeOpacity":o.strokeOpacity=l.split(":")[1];break;case"fillColor":o.fillColor=l.split(":")[1];break;case"fillOpacity":o.fillOpacity=l.split(":")[1];break}}}if(t.display){u=t.display}if(t.geoname){s=t.geoname}}var h=new WIND.Map.Part(e,i,o);h.geoname=s;h.viewer=this;h.vlayer=this.vectorLayers[r];h.object=id_annot;if(!this.toolbar)this.parts.push(h);if(u){var p=h.feature.geometry.clone();p.transform(new OpenLayers.Projection("EPSG:4326"),this.olMap.baseLayer.projection);var d=new OpenLayers.Feature.Vector(p,{},h.feature.style);this.vectorLayers[r].addFeatures([d])}return h};WIND.Map.Part=function(e,t,n){var r;if(n)r=n;else{r=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);r.strokeColor="#B26B00";r.strokeWidth=2;r.fillColor="#FECC80";r.fillOpacity=.3}if(e.startsWith("POLYGON")){var i=e.substring(9,e.length-2).split("),(");var s;var o=[];for(var u=0;u<i.length;u++){s=i[u];var a=s.split(",");var f;var l=[];for(var c=0;c<a.length;c++){f=a[c];l.push(new OpenLayers.Geometry.Point(f.split(" ")[0],f.split(" ")[1]))}o.push(new OpenLayers.Geometry.LinearRing(l))}var h=new OpenLayers.Geometry.Polygon(o);id_annot=h.id;var p=id_annot.split("_")[3];var d=parseInt(p);d+=2;d=d.toString();id_annot=id_annot.replace(p,d);if(t)h.transform(new OpenLayers.Projection(t),new OpenLayers.Projection("EPSG:4326"));this.feature=new OpenLayers.Feature.Vector(h,{},r)}if(e.startsWith("MULTIPOLYGON")){var v=e.substring(15,e.length-3).split(")),((");var h;var m=[];for(var u=0;u<v.length;u++){h=v[u];var i=h.split("),(");var s;var o=[];for(var c=0;c<i.length;c++){s=i[c];var a=s.split(",");var f;var l=[];for(var g=0;g<a.length;g++){f=a[g];l.push(new OpenLayers.Geometry.Point(f.split(" ")[0],f.split(" ")[1]))}o.push(new OpenLayers.Geometry.LinearRing(l))}var y=new OpenLayers.Geometry.Polygon(o);id_annot=y.id;var p=id_annot.split("_")[3];var d=parseInt(p);d+=4;d=d.toString();id_annot=id_annot.replace(p,d);m.push(y)}var b=new OpenLayers.Geometry.MultiPolygon(m);if(t)b.transform(new OpenLayers.Projection(t),new OpenLayers.Projection("EPSG:4326"));this.feature=new OpenLayers.Feature.Vector(b,{},r)}else if(e.startsWith("LINESTRING")){var a=e.substring(11,e.length-1).split(",");var f;var l=[];for(var u=0;u<a.length;u++){f=a[u];l.push(new OpenLayers.Geometry.Point(f.split(" ")[0],f.split(" ")[1]))}var w=new OpenLayers.Geometry.LineString(l);if(t)w.transform(new OpenLayers.Projection(t),new OpenLayers.Projection("EPSG:4326"));this.feature=new OpenLayers.Feature.Vector(w,{},r)}else if(e.startsWith("MULTILINESTRING")){var E=e.substring(17,e.length-2).split("),(");var w;var S=[];for(var u=0;u<E.length;u++){w=E[u];var a=w.split(",");var f;var l=[];for(var c=0;c<a.length;c++){f=a[c];l.push(new OpenLayers.Geometry.Point(f.split(" ")[0],f.split(" ")[1]))}var x=new OpenLayers.Geometry.LineString(l);S.push(x)}var T=new OpenLayers.Geometry.MultiLineString(S);if(t)T.transform(new OpenLayers.Projection(t),new OpenLayers.Projection("EPSG:4326"));this.feature=new OpenLayers.Feature.Vector(T,{},r)}else if(e.startsWith("POINT")){var N=e.substring(6,e.length-1).split(" ");var f=new OpenLayers.Geometry.Point(N[0],N[1]);if(t)f.transform(new OpenLayers.Projection(t),new OpenLayers.Projection("EPSG:4326"));this.feature=new OpenLayers.Feature.Vector(f,{},r)}else if(e.startsWith("MULTIPOINT")){var a=e.substring(11,e.length-1).split(",");var N,f;var l=[];for(var u=0;u<a.length;u++){f=a[u];N=f.substring(1,f.length-1).split(" ");l.push(new OpenLayers.Geometry.Point(N[0],N[1]))}var C=new OpenLayers.Geometry.MultiPoint(l);if(t)C.transform(new OpenLayers.Projection(t),new OpenLayers.Projection("EPSG:4326"));this.feature=new OpenLayers.Feature.Vector(C,{},r)}else if(e.startsWith("MULTIMARKER")){var k=e.substring(13,e.length-1).split("), ");var a=k[0].split(",");var N,f;var l=[];for(var u=0;u<a.length;u++){f=a[u];N=f.substring(1,f.length-1).split(" ");l.push(new OpenLayers.Geometry.Point(N[0],N[1]))}var C=new OpenLayers.Geometry.MultiPoint(l);if(t)C.transform(new OpenLayers.Projection(t),new OpenLayers.Projection("EPSG:4326"));r.externalGraphic=k[1];r.pointRadius=15;r.graphicXOffset=-15;r.graphicYOffset=-30;r.fillOpacity=1;this.feature=new OpenLayers.Feature.Vector(C,{},r)}else if(e.startsWith("MARKER")){var k=e.substring(7,e.length-1).split(",");var N=k[0].substring(1,k[0].length-1).split(" ");var f=new OpenLayers.Geometry.Point(N[0],N[1]);if(t)f.transform(new OpenLayers.Projection(t),new OpenLayers.Projection("EPSG:4326"));if(k.length>1)r.externalGraphic=k[1];else r.externalGraphic=lib_path+"images/marker-gold.png";r.pointRadius=15;r.graphicXOffset=-15;r.graphicYOffset=-30;r.fillOpacity=1;this.feature=new OpenLayers.Feature.Vector(f,{},r)}this.style=r;this.geoObject=e;this.vlayer=null};WIND.Map.Part.prototype=new WIND.SensiblePart("map");WIND.Map.Part.prototype.show=function(){if(this.feature.style.oldstrokeOpacity>=0)this.feature.style.strokeOpacity=this.feature.style.oldstrokeOpacity;if(this.feature.style.oldfillOpacity>=0)this.feature.style.fillOpacity=this.feature.style.oldfillOpacity;this.vlayer.redraw()};WIND.Map.Part.prototype.hide=function(){if(this.feature.style.strokeOpacity||this.feature.style.fillOpacity){this.feature.style.oldstrokeOpacity=this.feature.style.strokeOpacity;this.feature.style.oldfillOpacity=this.feature.style.fillOpacity;this.feature.style.strokeOpacity=0;this.feature.style.fillOpacity=0;this.vlayer.redraw()}};WIND.Map.Part.prototype.zoomTo=function(){var e=this.feature.geometry.clone();e.transform(new OpenLayers.Projection("EPSG:4326"),this.viewer.olMap.baseLayer.projection);if(e instanceof OpenLayers.Geometry.Point){this.viewer.olMap.setCenter(new OpenLayers.LonLat(e.x,e.y),15)}else{var t=Math.min(this.viewer.olMap.getZoomForExtent(e.getBounds()),15);var n=e.getBounds().getCenterLonLat();this.viewer.olMap.setCenter(n,t)}};WIND.Map.Part.prototype.zoomWith=function(e){var t=this.feature.geometry.clone();if(e instanceof WIND.Map.Part)var n=e.feature.geometry.clone();else if(e instanceof WIND.Annotation)var n=e.annotedObjects[0].feature.geometry.clone();t.transform(new OpenLayers.Projection("EPSG:4326"),this.viewer.olMap.baseLayer.projection);n.transform(new OpenLayers.Projection("EPSG:4326"),this.viewer.olMap.baseLayer.projection);var r=t.getBounds();var i=n.getBounds();i.extend(r);this.viewer.olMap.zoomToExtent(i);var s=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);s.fillOpacity=0;var o=new OpenLayers.Feature.Vector(i.toGeometry(),{},s);this.vlayer.addFeatures([o]);var u=this;window.setTimeout(function(){u.vlayer.removeFeatures([o])},1e3)};WIND.Map.Part.prototype.highlight=function(){this.feature.style.strokeColor="green";this.feature.style.strokeWidth=3;this.feature.style.fillColor="blue";this.vlayer.redraw()};WIND.Map.Part.prototype.setFeatureStyle=function(e){var t=false;if(e.strokeColor!=this.feature.style.strokeColor){this.feature.style.strokeColor=e.strokeColor;t=true}if(e.strokeWidth!=this.feature.style.strokeWidth){this.feature.style.strokeWidth=e.strokeWidth;t=true}if(e.strokeOpacity!=this.feature.style.strokeOpacity){this.feature.style.strokeOpacity=e.strokeOpacity;t=true}if(e.fillColor!=this.feature.style.fillColor){this.feature.style.fillColor=e.fillColor;t=true}if(e.fillOpacity!=this.feature.style.fillOpacity){this.feature.style.fillOpacity=e.fillOpacity;t=true}if(e.icon){this.feature.style.externalGraphic=e.icon;this.feature.style.pointRadius=15;this.feature.style.graphicXOffset=-15;this.feature.style.graphicYOffset=-30}if(t){this.vlayer.drawFeature(this.feature,e);this.vlayer.redraw()}};WIND.Map.Marker=function(e,t,n,r){this.point=new OpenLayers.Geometry.Point(e,t);if(n)this.icon=n;else this.icon=lib_path+"images/marker-gold.png";if(r)this.size=r;else this.size=15};WIND.Map.prototype.addMarker=function(e,t){var n;if(!t||!this.vlIndex.indexOf(t))n=0;else n=t;var r=e.point.clone();var i=e.icon;var s=e.size;r.transform(new OpenLayers.Projection("EPSG:4326"),this.olMap.baseLayer.projection);var o=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);o.externalGraphic=i;o.pointRadius=s;o.graphicXOffset=-s;o.graphicYOffset=-2*s;o.fillOpacity=1;var u=new OpenLayers.Feature.Vector(r,{},o);this.vectorLayers[n].addFeatures([u])};WIND.Map.Itinerary=function(e){this.wayPoints=e;this.start=this.wayPoints[0];this.end=this.wayPoints[this.wayPoints.length-1]};WIND.Map.prototype.addItinerary=function(e,t){var n=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);n.strokeWidth=2;var r="direct";var i=G_TRAVEL_MODE_DRIVING;var s=false;var o=e.wayPoints;var u=[];u.push(lib_path+"images/depart.png");if(o.length>2){for(var a=1;a<o.length-1;a++){u.push(lib_path+"images/relais.png")}}u.push(lib_path+"images/arrivee.png");if(t){if(t.mode)r=t.mode;if(t.travelMode)i=t.travelMode;if(t.avoidHighways)s=t.avoidHighways;if(t.color)n.strokeColor=t.color;if(t.icons)u=t.icons}if(r=="route"){var f=[];for(var a=0;a<o.length;a++){f.push(new GLatLng(o[a].y,o[a].x))}var l=new GDirections;var c=this;GEvent.addListener(l,"load",function(){var e=l.getPolyline();if(e){var t=Math.round(e.getLength()/1e3);var r=[];for(var i=0;i<e.getVertexCount();i++){var s=new OpenLayers.Geometry.Point(e.getVertex(i).lng(),e.getVertex(i).lat());r.push(s)}var o=new OpenLayers.Geometry.LineString(r);o.transform(new OpenLayers.Projection("EPSG:4326"),c.olMap.baseLayer.projection);var u=new OpenLayers.Feature.Vector(o,{},n);c.vectorLayers[0].addFeatures([u])}});GEvent.addListener(l,"error",function(){switch(l.getStatus().code){case G_GEO_BAD_REQUEST:alert("A directions request could not be successfully parsed.\n Error code: "+l.getStatus().code);break;case G_GEO_SERVER_ERROR:alert("A geocoding or directions request could not be successfully processed, yet the exact reason for the failure is not known.\n Error code: "+l.getStatus().code);break;case G_GEO_MISSING_QUERY:alert("The HTTP q parameter was either missing or had no value. For geocoder requests, this means that an empty address was specified as input. For directions requests, this means that no query was specified in the input.\n Error code: "+l.getStatus().code);break;case G_GEO_UNKNOWN_ADDRESS:alert("No corresponding geographic location could be found for one of the specified addresses. This may be due to the fact that the address is relatively new, or it may be incorrect.\nError code: "+l.getStatus().code);break;case G_GEO_UNAVAILABLE_ADDRESS:alert("The geocode for the given address or the route for the given directions query cannot be returned due to legal or contractual reasons.\n Error code: "+l.getStatus().code);break;case G_GEO_UNKNOWN_DIRECTIONS:alert("The GDirections object could not compute directions between the points mentioned in the query. This is usually because there is no route available between the two points, or because we do not have data for routing in that region.\n Error code: "+l.getStatus().code);break;case G_GEO_BAD_KEY:alert("The given key is either invalid or does not match the domain for which it was given. \n Error code: "+l.getStatus().code);break;case G_GEO_TOO_MANY_QUERIES:alert("The given key has gone over the requests limit in the 24 hour period or has submitted too many requests in too short a period of time. If you're sending multiple requests in parallel or in a tight loop, use a timer or pause in your code to make sure you don't send the requests too quickly.\n Error code: "+l.getStatus().code);break;default:alert("An unknown error occurred.");break}});l.loadFromWaypoints(f,{local:"FR",getPolyline:true,travelMode:i,avoidHighways:s})}else{var h=(new OpenLayers.Geometry.LineString(o)).clone();h.transform(new OpenLayers.Projection("EPSG:4326"),this.olMap.baseLayer.projection);var p=new OpenLayers.Feature.Vector(h,{},n);this.vectorLayers[0].addFeatures([p])}this.addMarker(new WIND.Map.Marker(o[0],u[0],15));this.addMarker(new WIND.Map.Marker(o[o.length-1],u[o.length-1],15));if(o.length>2){for(var a=1;a<o.length-1;a++){this.addMarker(new WIND.Map.Marker(o[a],u[a],15))}}};comparerNumber=function(e,t){if(e<t){var n=t;t=e;e=n}var r=e-t;if(r<.001)return true;else return false};comparerGeo=function(e,t){if(e instanceof OpenLayers.Geometry.Polygon){if(t instanceof OpenLayers.Geometry.Polygon){return comparerPolygon(e,t)}else return false}if(e instanceof OpenLayers.Geometry.MultiPolygon){if(t instanceof OpenLayers.Geometry.MultiPolygon){return comparerMultiPolygon(e,t)}else return false}else if(e instanceof OpenLayers.Geometry.LineString){if(t instanceof OpenLayers.Geometry.LineString){return comparerLineString(e,t)}else return false}else if(e instanceof OpenLayers.Geometry.MultiLineString){if(t instanceof OpenLayers.Geometry.MultiLineString){return comparerMultiLineString(e,t)}else return false}else if(e instanceof OpenLayers.Geometry.Point){if(t instanceof OpenLayers.Geometry.Point){return comparerPoint(e,t)}else return false}else if(e instanceof OpenLayers.Geometry.MultiPoint){if(t instanceof OpenLayers.Geometry.MultiPoint){return comparerMultiPoint(e,t)}else return false}else return false};comparerPolygon=function(e,t){var n=e.components.length;var r=t.components.length;if(n==r){var i=true;for(var s=0;s<n;s++){if(comparerLineString(e.components[s],t.components[s])==false){i=false;break}}return i}else return false};comparerMultiPolygon=function(e,t){var n=e.components.length;var r=t.components.length;if(n==r){var i=true;for(var s=0;s<n;s++){if(comparerPolygon(e.components[s],t.components[s])==false){i=false;break}}return i}else return false};comparerLineString=function(e,t){var n=e.components.length;var r=t.components.length;if(n==r){var i=true;for(var s=0;s<n;s++){if(comparerPoint(e.components[s],t.components[s])==false){i=false;break}}return i}else return false};comparerMultiLineString=function(e,t){var n=e.components.length;var r=t.components.length;if(n==r){var i=true;for(var s=0;s<n;s++){if(comparerLineString(e.components[s],t.components[s])==false){i=false;break}}return i}else return false};comparerPoint=function(e,t){if(comparerNumber(e.x,t.x)&&comparerNumber(e.y,t.y))return true;else return false};comparerMultiPoint=function(e,t){var n=e.components.length;var r=t.components.length;if(n==r){var i=true;for(var s=0;s<n;s++){if(comparerPoint(e.components[s],t.components[s])==false){i=false;break}}return i}else return false};pointNearByLine=function(e,t){if(e instanceof OpenLayers.Geometry.Point&&(t instanceof OpenLayers.Geometry.LineString||t instanceof OpenLayers.Geometry.MultiLineString)){if(e.distanceTo(t)<.01)return true}else return false};sortPoints=function(e){var t=e[0];for(var n=0;n<e.length;n++){if(e[n].y<t.y)t=e[n];else if(e[n].y==t.y&&e[n].x<t.x)t=e[n]}var r=[];var i=[];var s=[];var o=[];for(var n=0;n<e.length;n++){var u=e[n].x-t.x;var a=e[n].y-t.y;if(u!=0){var f=a/u;if(f<0)s.push({point:e[n],cotangent:f});else i.push({point:e[n],cotangent:f})}else o.push({point:e[n],dy:a})}r.push(t);sortDescending(s,"cotangent");for(var n=0;n<s.length;n++){if(r[r.length-1].x==s[n].point.x&&r[r.length-1].y==s[n].point.y)continue;r.push(s[n].point)}sortDescending(o,"dy");r.push(o[0].point);sortDescending(i,"cotangent");for(var n=0;n<i.length;n++){if(r[r.length-1].x==i[n].point.x&&r[r.length-1].y==i[n].point.y)continue;r.push(i[n].point)}return r};sortDescending=function(e,t){var n;if(t=="cotangent"){for(var r=0;r<e.length-1;r++){for(var i=r+1;i<e.length;i++){if(e[r].cotangent<e[i].cotangent){n=e[r];e[r]=e[i];e[i]=n}}}}if(t=="dy"){for(var r=0;r<e.length-1;r++){for(var i=r+1;i<e.length;i++){if(e[r].dy<e[i].dy){n=e[r];e[r]=e[i];e[i]=n}}}}};directionFunc=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)};WIND.Map.createConvexPolygon=function(e){var t=sortPoints(e);var n=[];n.push(t[0]);n.push(t[1]);for(var r=2;r<t.length;r++){while(directionFunc(n[n.length-2],n[n.length-1],t[r])>0)n.pop();n.push(t[r])}var i=new OpenLayers.Geometry.LinearRing(n);return new OpenLayers.Geometry.Polygon([i])}